<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Tidemark</title>
  <link rel="stylesheet" href="popup.css">
</head>
<body>
  <div id="app">
    <!-- Header with platform theme -->
    <div id="header">
      <h1 id="title">Tidemark</h1>
      <div id="platform-indicator"></div>
    </div>

    <!-- Error message area -->
    <div id="error-message" class="error hidden"></div>

    <!-- Video info section -->
    <div id="video-info" class="hidden">
      <div id="video-title"></div>
      <div id="video-time"></div>
    </div>

    <!-- Record form -->
    <div id="record-form">
      <input
        type="text"
        id="topic-input"
        placeholder="輸入主題名稱 (可選)"
        maxlength="100"
      />
      <button id="record-button" class="primary">
        記錄當前時間
      </button>
    </div>

    <!-- Two-panel layout: Folders + Records -->
    <div id="main-container">
      <!-- Left sidebar: Folders -->
      <div id="folders-sidebar">
        <div id="folders-header">
          <h2>資料夾</h2>
        </div>
        <div id="folder-create">
          <input
            type="text"
            id="folder-input"
            placeholder="新增資料夾..."
            maxlength="50"
          />
          <button id="folder-add-button" title="新增資料夾">+</button>
        </div>
        <div id="folders-list"></div>
      </div>

      <!-- Right panel: Records -->
      <div id="records-section">
        <div id="records-header">
          <h2>記錄列表</h2>
          <div id="record-count"></div>
        </div>
        <div id="records-list"></div>
        <div id="no-records" class="empty-state hidden">
          尚無記錄
        </div>
      </div>
    </div>

    <!-- Settings section (collapsed by default) -->
    <div id="settings-section">
      <button id="settings-toggle" class="settings-toggle">
        ⚙️ 設定
      </button>
      <div id="settings-content" class="settings-content hidden">
        <!-- Cloud Sync Settings -->
        <div class="settings-group">
          <h3>雲端同步</h3>

          <div id="sync-status-display" class="settings-item">
            <div class="sync-status">
              <span id="sync-status-icon">⚪</span>
              <span id="sync-status-text">未登入</span>
            </div>
          </div>

          <div id="sync-logged-out" class="settings-item">
            <button id="login-button" class="primary">
              🔐 使用 Google 登入
            </button>
            <p class="settings-description">
              登入後可在多個裝置間同步記錄與資料夾
            </p>
            <details class="test-mode">
              <summary style="cursor: pointer; color: #999; font-size: 12px; margin-top: 8px;">開發測試模式</summary>
              <div style="margin-top: 8px;">
                <input
                  type="text"
                  id="test-jwt-input"
                  placeholder="貼上測試 JWT"
                  style="width: 100%; padding: 6px; font-size: 12px; font-family: monospace;"
                />
                <button id="test-jwt-button" class="secondary" style="margin-top: 4px; font-size: 12px;">
                  設定測試 JWT
                </button>
              </div>
            </details>
          </div>

          <div id="sync-logged-in" class="settings-item hidden">
            <p class="settings-description">
              已登入為: <strong id="user-email"></strong>
            </p>
            <button id="logout-button" class="secondary">
              登出
            </button>
          </div>
        </div>

        <div class="settings-group">
          <h3>資料備份與還原</h3>

          <div class="settings-item">
            <button id="export-button" class="secondary">
              📥 匯出資料
            </button>
            <p class="settings-description">
              匯出所有記錄與資料夾為 JSON 檔案
            </p>
          </div>

          <div class="settings-item">
            <button id="import-button" class="secondary">
              📤 匯入資料
            </button>
            <input
              type="file"
              id="import-file-input"
              accept=".json,application/json"
              style="display: none;"
            />
            <p class="settings-description">
              從 JSON 檔案匯入記錄與資料夾
            </p>
          </div>
        </div>
      </div>
    </div>

    <!-- Import mode selection modal -->
    <div id="import-modal" class="modal hidden">
      <div class="modal-content">
        <h3>選擇匯入模式</h3>
        <p class="modal-description">
          找到 <span id="import-stats"></span>
        </p>
        <div class="modal-buttons">
          <button id="import-merge-button" class="primary">
            合併 (Merge)
          </button>
          <button id="import-overwrite-button" class="secondary">
            覆寫 (Overwrite)
          </button>
          <button id="import-cancel-button" class="tertiary">
            取消
          </button>
        </div>
        <div class="modal-help">
          <p><strong>合併:</strong> 將匯入的資料加入現有資料，重複的 ID 會被跳過</p>
          <p><strong>覆寫:</strong> 刪除所有現有資料，並替換為匯入的資料</p>
        </div>
      </div>
    </div>
  </div>

  <script src="popup/popup.js" type="module"></script>
</body>
</html>
